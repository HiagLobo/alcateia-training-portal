<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Treinamento | Equipe Alcateia / doTERRA</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <script src="/api-adapter.js"></script>
    

    <style>
:root {
            --dark-gray: #2c2c2c;
            --medium-gray: #3a3a3a;
            --light-gray: #4a4a4a;
            --gold: #d4af37;
            --light-gold: #f4e4a6;
            --white: #f0f0f0; /* Um branco ligeiramente off-white para conforto visual em dark mode */
            --green: #4caf50;
            --red: #f44336;
            --blue: #2196f3;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            line-height: 1.6;
            background-color: var(--dark-gray);
            color: var(--white);
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23d4af37' fill-opacity='0.02' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background-color: var(--medium-gray);
            padding: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo-icon {
            font-size: 28px;
            margin-right: 10px;
            color: var(--gold);
        }

        .logo-text {
            font-size: 22px;
            font-weight: bold;
        }

        .logo-text span {
            color: var(--gold);
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin-left: 20px;
        }

        nav ul li a {
            color: var(--white);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            padding: 8px 12px;
            border-radius: 4px;
        }

        nav ul li a:hover {
            color: var(--gold);
            background-color: rgba(212, 175, 55, 0.1);
        }
        
        nav ul li a.active {
            color: var(--gold);
            background-color: rgba(212, 175, 55, 0.2);
            border-bottom: 2px solid var(--gold);
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            color: var(--gold);
            font-weight: bold;
        }

        .logout-btn {
            background-color: var(--light-gray);
            color: var(--white);
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-left: 15px;
        }

        .logout-btn:hover {
            background-color: var(--red);
        }

        /* New Ranking Cards Styles */
        .ranking-cards-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 cards por linha em desktop */
            gap: 20px;
            margin-bottom: 40px;
        }

        @media (max-width: 1024px) {
            .ranking-cards-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .ranking-cards-container {
                grid-template-columns: 1fr; /* 1 card por linha em telas menores */
            }
        }

        .consultor-card {
            background-color: var(--medium-gray);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            border: 1px solid transparent;
            transition: border-color 0.3s;
        }

        .consultor-card:hover {
            border-color: var(--gold);
        }

        .consultor-card-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 15px;
            border: 3px solid var(--gold);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }

        .consultor-card-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .consultor-card-ranking {
            font-size: 16px;
            color: var(--gold);
            font-weight: 600;
            margin-bottom: 10px;
        }

        .consultor-card-description {
            font-size: 14px;
            color: #cccccc;
        }

        /* Admin Panel Styles for Ranking */
        .admin-ranking-controls {
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--light-gray);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-ranking-list {
            list-style: none;
            padding: 0;
        }

        .admin-ranking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .admin-ranking-item:last-child {
            border-bottom: none;
        }

        .admin-ranking-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .admin-ranking-info img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .admin-ranking-actions button {
            margin-left: 10px;
        }


        /* Main Content Styles */
        main {
            padding: 30px 0;
            min-height: calc(100vh - 140px);
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .welcome-message h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .welcome-message p {
            color: #cccccc;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--medium-gray);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        .stat-card h3 {
            font-size: 14px;
            color: #cccccc;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--gold);
        }

        .stat-description {
            font-size: 12px;
            color: #aaaaaa;
            margin-top: 5px;
        }

        .progress-bar {
            height: 8px;
            background-color: var(--light-gray);
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--gold);
            border-radius: 4px;
        }

        /* Training Paths Section */
        .section-title {
            font-size: 22px;
            margin: 40px 0 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--light-gray);
        }

        .training-paths {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .path-card {
            background-color: var(--medium-gray);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .path-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
        }

        .path-header {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: var(--light-gray);
        }

        .path-icon {
            font-size: 24px;
            margin-right: 10px;
            color: var(--gold);
        }

        .path-title {
            font-size: 18px;
            font-weight: bold;
        }

        .path-content {
            padding: 15px;
        }

        .path-description {
            font-size: 14px;
            color: #cccccc;
            margin-bottom: 15px;
            min-height: 40px;
        }

        .path-stats {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #aaaaaa;
            margin-bottom: 10px;
        }

        .path-btn {
            display: block;
            width: 100%;
            padding: 10px;
            margin-top: 15px;
            background-color: var(--gold);
            color: var(--dark-gray);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .path-btn:hover {
            background-color: var(--light-gold);
        }

        /* Training Content Page Styles */
        .training-content-grid {
            display: grid;
            grid-template-columns: 3fr 1fr;
            gap: 30px;
        }

        @media (max-width: 992px) {
            .training-content-grid {
                grid-template-columns: 1fr;
            }
        }

        .video-player-container {
            background-color: var(--medium-gray);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        #video-player {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
        }

        #video-player iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .video-details {
            padding: 20px;
            background-color: var(--medium-gray);
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        .video-details h2 {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--gold);
        }

        .video-details p {
            font-size: 16px;
            color: #cccccc;
            margin-bottom: 20px;
        }

        .complete-module-btn {
            padding: 10px 20px;
            background-color: var(--green);
            color: var(--white);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .complete-module-btn:hover {
            background-color: #388e3c;
        }

        .complete-module-btn.completed {
            background-color: var(--light-gray);
            color: var(--white);
            cursor: default;
        }

        .complete-module-btn.completed:hover {
            background-color: var(--light-gray);
        }

        .modules-sidebar {
            background-color: var(--medium-gray);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .modules-sidebar h3 {
            font-size: 18px;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--light-gray);
            padding-bottom: 10px;
        }

        .modules-list {
            list-style: none;
            padding: 0;
        }

        .module-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background-color: var(--light-gray);
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s, border-left 0.2s;
            border-left: 5px solid transparent;
        }

        .module-item:hover {
            background-color: #5a5a5a;
        }

        .module-item.active {
            border-left: 5px solid var(--gold);
            background-color: #5a5a5a;
        }

        .module-item.completed {
            background-color: #384d38; /* Um verde mais escuro para indicar conclus√£o */
            border-left: 5px solid var(--green);
        }

        .module-item.completed:hover {
            background-color: #4a634a;
        }

        .module-info {
            flex-grow: 1;
        }

        .module-title {
            font-weight: 500;
        }

        .module-duration {
            font-size: 12px;
            color: #aaaaaa;
        }

        .module-status {
            font-size: 18px;
            color: var(--gold);
            font-weight: bold;
        }

        .module-item.completed .module-status {
            color: var(--green);
        }

        /* Ranking Page Styles */
        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: var(--medium-gray);
            border-radius: 8px;
            overflow: hidden;
        }

        .ranking-table th, .ranking-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--light-gray);
        }

        .ranking-table th {
            background-color: var(--light-gray);
            color: var(--gold);
            font-weight: bold;
            text-transform: uppercase;
            font-size: 14px;
        }

        .ranking-table tr:hover {
            background-color: #4a4a4a;
        }

        .ranking-table tr:last-child td {
            border-bottom: none;
        }

        .ranking-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 10px;
        }

        .ranking-name {
            display: flex;
            align-items: center;
        }

        .ranking-score {
            font-weight: bold;
            color: var(--light-gold);
        }

        /* Certificados Page Styles */
        .certificates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .certificate-card {
            background-color: var(--medium-gray);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .certificate-icon {
            font-size: 48px;
            color: var(--gold);
            margin-bottom: 10px;
        }

        .certificate-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .certificate-date {
            font-size: 14px;
            color: #aaaaaa;
            margin-bottom: 15px;
        }

        .download-btn {
            padding: 8px 15px;
            background-color: var(--blue);
            color: var(--white);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .download-btn:hover {
            background-color: #1e88e5;
        }

        /* Admin Panel Styles */
        .admin-panel {
            margin-top: 40px;
            padding: 20px;
            background-color: #333333;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .admin-panel h2 {
            color: var(--red);
            border-bottom: 2px solid var(--red);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .admin-section {
            margin-bottom: 30px;
            padding: 15px;
            background-color: var(--light-gray);
            border-radius: 6px;
        }

        .admin-section h3 {
            margin-top: 0;
            color: var(--gold);
            margin-bottom: 15px;
        }

        .admin-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: var(--green);
            color: var(--white);
        }

        .btn-primary:hover {
            background-color: #388e3c;
        }

        .btn-secondary {
            background-color: var(--blue);
            color: var(--white);
        }

        .btn-secondary:hover {
            background-color: #1e88e5;
        }

        .btn-danger {
            background-color: var(--red);
            color: var(--white);
        }

        .btn-danger:hover {
            background-color: #d32f2f;
        }

        /* Modal Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--dark-gray);
            margin: auto;
            padding: 20px;
            border: 1px solid var(--light-gray);
            width: 80%;
            max-width: 700px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            position: relative;
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: var(--white);
            text-decoration: none;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            background-color: var(--medium-gray);
            color: var(--white);
            box-sizing: border-box;
        }

        .form-control:focus {
            border-color: var(--gold);
            outline: none;
        }

        .module-item-form {
            border: 1px solid var(--light-gray);
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            background-color: #333333;
        }

        .module-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            border-bottom: 1px solid var(--light-gray);
            padding-bottom: 5px;
        }

        .module-item-title {
            font-weight: bold;
            color: var(--light-gold);
        }

        .remove-module {
            background: none;
            border: none;
            color: var(--red);
            font-size: 20px;
            cursor: pointer;
        }

        /* Login Page Styles */
        .login-page {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--dark-gray);
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23d4af37' fill-opacity='0.02' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .login-container {
            background-color: var(--medium-gray);
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-container h2 {
            color: var(--gold);
            margin-bottom: 25px;
            font-size: 28px;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--gold);
            color: var(--dark-gray);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        .login-btn:hover {
            background-color: var(--light-gold);
        }

        .login-help {
            margin-top: 20px;
            font-size: 14px;
        }

        .login-help a {
            color: var(--gold);
            text-decoration: none;
            transition: color 0.3s;
        }

        .login-help a:hover {
            color: var(--light-gold);
        }
    </style>
</head>
<body>

    <!-- Login Page -->
    <div id="login-page" class="login-page">
        <div class="login-container">
            <h2>Portal de Treinamento</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Usu√°rio</label>
                    <input type="text" id="username" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="password">Senha</label>
                    <input type="password" id="password" class="form-control" required>
                </div>
                <button type="submit" class="login-btn">Entrar</button>
            </form>
            <div class="login-help">
                <p>Primeiro acesso? Entre em contato com o administrador.</p>
                <a href="#" id="admin-login-link">Acesso r√°pido para administradores (Demo)</a>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app" style="display: none;">
        <header>
            <div class="container header-content">
                <div class="logo">
                    <span class="logo-icon">üê∫</span>
                    <span class="logo-text">Alcateia <span>Treinamento</span></span>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" class="nav-link active" data-page="dashboard">Dashboard</a></li>
                        <li><a href="#" class="nav-link" data-page="training">Treinamentos</a></li>
                        <li><a href="#" class="nav-link" data-page="ranking">Ranking</a></li>
                        <li><a href="#" class="nav-link" data-page="certificates">Certificados</a></li>
                    </ul>
                </nav>
                <div class="user-info">
                    <div class="user-avatar">U</div>
                    <span>Usu√°rio</span>
                    <button class="logout-btn" id="logout-btn">Sair</button>
                </div>
            </div>
        </header>

        <main class="container">
            <!-- Dashboard Page -->
            <section id="dashboard-page" class="page active">
                <div class="dashboard-header">
                    <div class="welcome-message">
                        <h1>Bem-vindo(a), Usu√°rio!</h1>
                        <p>Seu portal de desenvolvimento e crescimento.</p>
                    </div>
                </div>

                <div id="stats-cards" class="stats-cards">
                    <!-- Cards de estat√≠sticas ser√£o renderizados aqui -->
                    <div class="stat-card">
                        <h3>Progresso Geral</h3>
                        <div class="stat-value">0%</div>
                        <div class="progress-bar"><div class="progress-fill" style="width: 0%;"></div></div>
                        <div class="stat-description">Comece sua primeira trilha para ver seu progresso aqui!</div>
                    </div>
                    <div class="stat-card">
                        <h3>Trilha Atual</h3>
                        <div class="stat-value">Nenhuma</div>
                        <div class="stat-description">Selecione uma trilha abaixo para come√ßar.</div>
                    </div>
                    <div class="stat-card">
                        <h3>Horas de Estudo</h3>
                        <div class="stat-value">0h</div>
                        <div class="stat-description">Tempo total dedicado ao treinamento.</div>
                    </div>
                    <div class="stat-card">
                        <h3>Pr√≥xima Meta</h3>
                        <div class="stat-value">Come√ßar!</div>
                        <div class="stat-description">Conclua o primeiro m√≥dulo de qualquer trilha.</div>
                    </div>
                </div>

                <h2 class="section-title">Minhas Trilhas de Treinamento</h2>
                <div id="dashboard-paths" class="training-paths">
                    <!-- Trilhas de treinamento ser√£o renderizadas aqui -->
                </div>

                <!-- Admin Panel -->
                <div id="admin-panel" class="admin-panel" style="display: none;">
                    <h2>Painel Administrativo</h2>

                    <!-- Gerenciamento de Trilhas -->
                    <div class="admin-section">
                        <h3>Gerenciamento de Trilhas</h3>
                        <div class="admin-controls">
                            <button class="btn btn-primary" id="new-path-btn">Nova Trilha</button>
                            <button class="btn btn-secondary" id="export-paths-btn">Exportar JSON</button>
                            <input type="file" id="import-paths-input" accept=".json" style="display: none;">
                            <button class="btn btn-secondary" id="import-paths-btn">Importar JSON</button>
                        </div>
                        <div id="admin-paths-list">
                            <!-- Lista de trilhas para admin -->
                        </div>
                    </div>

                    <!-- Gerenciamento de Usu√°rios -->
                    <div class="admin-section">
                        <h3>Gerenciamento de Usu√°rios</h3>
                        <div class="admin-controls">
                            <button class="btn btn-primary" id="new-user-btn">Novo Usu√°rio</button>
                        </div>
                        <div id="users-list-container">
                            <!-- Lista de usu√°rios para admin -->
                        </div>
                    </div>
                    
                    <!-- Gerenciamento de Ranking -->
                    <div class="admin-section">
                        <h3>Gerenciamento de Ranking</h3>
                        <div class="admin-controls">
                            <button class="btn btn-primary" id="new-consultor-btn">Adicionar Novo Consultor</button>
                        </div>
                        <div id="admin-ranking-list-container">
                            <!-- Lista de consultores para admin -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Training Page -->
            <section id="training-page" class="page" style="display: none;">
                <h2 class="section-title">Cat√°logo Completo de Treinamentos</h2>
                <div id="training-paths-container" class="training-paths">
                    <!-- Todas as trilhas de treinamento ser√£o renderizadas aqui -->
                </div>
            </section>

            <!-- Training Content Page -->
            <section id="training-content-page" class="page" style="display: none;">
                <button class="btn btn-secondary" id="back-to-training-btn">‚Üê Voltar para Treinamentos</button>
                <h2 class="section-title" id="training-path-title">Nome da Trilha</h2>
                <p id="training-path-description">Descri√ß√£o da trilha.</p>
                
                <div class="training-content-grid">
                    <div class="video-section">
                        <div id="video-container" class="video-player-container" style="display: none;">
                            <div id="video-player">
                                <!-- V√≠deo do m√≥dulo ser√° carregado aqui -->
                            </div>
                        </div>
                        <div class="video-details">
                            <h2 id="video-title">T√≠tulo do M√≥dulo</h2>
                            <p id="video-description">Descri√ß√£o do m√≥dulo.</p>
                            <button class="complete-module-btn" id="complete-module-btn">
                                <span id="complete-module-text">Marcar como conclu√≠do</span>
                            </button>
                            <div style="margin-top: 15px;">
                                <strong>Progresso na Trilha:</strong> <span id="path-progress-text">0 de 0 m√≥dulos conclu√≠dos</span>
                                <div class="progress-bar" style="margin-top: 5px;">
                                    <div id="path-progress-fill" class="progress-fill" style="width: 0%;"></div>
                                </div>
                                <small id="path-progress-percent" style="display: block; text-align: right; color: var(--gold);">0%</small>
                            </div>
                        </div>
                    </div>
                    <div class="modules-sidebar">
                        <h3>M√≥dulos da Trilha</h3>
                        <div id="modules-list" class="modules-list">
                            <!-- Lista de m√≥dulos ser√° renderizada aqui -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Ranking Page -->
            <section id="ranking-page" class="page" style="display: none;">
                <h2 class="section-title">Ranking de Consultores</h2>
                <div id="ranking-cards-container" class="ranking-cards-container">
                    <!-- Cards de ranking ser√£o renderizados aqui -->
                </div>
            </section>

            <!-- Certificados Page -->
            <section id="certificates-page" class="page" style="display: none;">
                <h2 class="section-title">Meus Certificados</h2>
                <div id="certificates-grid" class="certificates-grid">
                    <!-- Certificados ser√£o renderizados aqui -->
                </div>
            </section>
        </main>
    </div>

    <!-- Modal de Gerenciamento de Trilhas -->
    <div id="path-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="hidePathModal()">&times;</span>
            <h2 id="modal-title">Nova Trilha</h2>
            <form id="path-form">
                <input type="hidden" id="path-id">
                <div class="form-group">
                    <label for="path-name">Nome da Trilha</label>
                    <input type="text" id="path-name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="path-description">Descri√ß√£o</label>
                    <textarea id="path-description" class="form-control" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label for="path-icon">√çcone (Emoji ou Texto)</label>
                    <input type="text" id="path-icon" class="form-control" required>
                </div>

                <h3>M√≥dulos</h3>
                <div id="modules-container">
                    <!-- Formul√°rios de m√≥dulo ser√£o adicionados aqui -->
                </div>
                <button type="button" class="btn btn-secondary" id="add-module-btn">Adicionar M√≥dulo</button>
                
                <div class="form-group" style="margin-top: 20px;">
                    <button type="submit" class="btn btn-primary">Salvar Trilha</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Gerenciamento de Usu√°rios -->
    <div id="user-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeUserModal()">&times;</span>
            <h2 id="user-modal-title">Novo Usu√°rio</h2>
            <form id="user-form">
                <input type="hidden" id="user-id">
                <div class="form-group">
                    <label for="user-name">Nome Completo</label>
                    <input type="text" id="user-name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="user-username">Usu√°rio</label>
                    <input type="text" id="user-username" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="user-email">E-mail</label>
                    <input type="email" id="user-email" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="user-password">Senha</label>
                    <input type="password" id="user-password" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="user-role">Tipo de Usu√°rio</label>
                    <select id="user-role" class="form-control" required>
                        <option value="user">Usu√°rio</option>
                        <option value="admin">Administrador</option>
                    </select>
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <button type="submit" class="btn btn-primary">Salvar Usu√°rio</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Progresso do Usu√°rio (Admin) -->
    <div id="user-progress-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeUserProgressModal()">&times;</span>
            <div id="user-progress-content">
                <!-- Conte√∫do do progresso do usu√°rio ser√° renderizado aqui -->
            </div>
        </div>
    </div>

    <!-- Modal de Gerenciamento de Ranking -->
    <div id="ranking-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeRankingModal()">&times;</span>
            <h2 id="ranking-modal-title">Gerenciamento de Ranking</h2>
            
            <!-- Formul√°rio de Adi√ß√£o/Edi√ß√£o de Consultor (UX-03: Exibir imediatamente) -->
            <form id="consultor-form" style="margin-bottom: 20px;">
                <input type="hidden" id="consultor-id">
                <div class="form-group">
                    <label for="consultor-name">Nome do Consultor</label>
                    <input type="text" id="consultor-name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="consultor-ranking">Ranking (Ex: Diamante)</label>
                    <input type="text" id="consultor-ranking" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="consultor-description">Descri√ß√£o/Frase de Impacto</label>
                    <textarea id="consultor-description" class="form-control" rows="2" required></textarea>
                </div>
                <div class="form-group">
                    <label for="consultor-photo">URL da Foto (Opcional)</label>
                    <input type="url" id="consultor-photo" class="form-control">
                </div>
                <button type="submit" class="btn btn-primary">Salvar Consultor</button>
                <button type="button" class="btn btn-secondary" id="cancel-edit-consultor" style="display: none;">Cancelar Edi√ß√£o</button>
            </form>

            <!-- Lista de Consultores -->
            <h3 style="border-bottom: 1px solid var(--light-gray); padding-bottom: 10px; margin-bottom: 15px;">Consultores Atuais</h3>
            <div id="consultores-list">
                <!-- Lista de consultores ser√° renderizada aqui -->
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        const loginPage = document.getElementById('login-page');
        const app = document.getElementById('app');
        const navLinks = document.querySelectorAll('.nav-link');
        const pages = document.querySelectorAll('.page');
        const adminPanel = document.getElementById('admin-panel');
        const dashboardPaths = document.getElementById('dashboard-paths');
        const trainingPathsContainer = document.getElementById('training-paths-container');
        const adminPathsList = document.getElementById('admin-paths-list');
        const pathModal = document.getElementById('path-modal');
        const pathForm = document.getElementById('path-form');
        const modulesContainer = document.getElementById('modules-container');
        const completeModuleBtn = document.getElementById('complete-module-btn');
        const completeModuleText = document.getElementById('complete-module-text');
        const pathProgressText = document.getElementById('path-progress-text');
        const pathProgressFill = document.getElementById('path-progress-fill');
        const pathProgressPercent = document.getElementById('path-progress-percent');
        const statsCardsContainer = document.getElementById('stats-cards'); // Adicionado para UX-02

        let currentUser = null;
        let isAdmin = false;
        let trainingPaths = [];
        let currentPath = null;
        let currentModule = null;
        let editingPathId = null;
        let systemUsers = [];

        // --- Fun√ß√µes de Inicializa√ß√£o e Dados ---

        // Fun√ß√£o para carregar usu√°rios do localStorage
        function loadUsers() {
            const usersJson = localStorage.getItem('systemUsers');
            if (usersJson) {
                systemUsers = JSON.parse(usersJson);
            } else {
                // Usu√°rio Admin padr√£o (apenas para demonstra√ß√£o)
                systemUsers = [
                    { id: 1, username: 'admin', password: 'admin', name: 'Administrador Alcateia', email: 'admin@alcateia.com', role: 'admin' },
                    { id: 2, username: 'usuario1', password: '123', name: 'Usu√°rio Teste', email: 'user@teste.com', role: 'user' }
                ];
                saveUsers(systemUsers);
            }
        }

        // Fun√ß√£o para salvar usu√°rios no localStorage
        function saveUsers(users) {
            localStorage.setItem('systemUsers', JSON.stringify(users));
        }

        // Fun√ß√£o para autenticar usu√°rio
        function authenticateUser(username, password) {
            return systemUsers.find(user => user.username === username && user.password === password);
        }

        // Fun√ß√£o para carregar trilhas de treinamento
        function loadTrainingPaths() {
            const pathsJson = localStorage.getItem('trainingPaths');
            if (pathsJson) {
                trainingPaths = JSON.parse(pathsJson);
            } else {
                // Dados de trilhas padr√£o (apenas para demonstra√ß√£o)
                trainingPaths = [
                    {
                        id: 1,
                        name: 'Trilha Essencial doTERRA',
                        description: 'Tudo o que voc√™ precisa saber para come√ßar seu neg√≥cio doTERRA com o p√© direito.',
                        icon: 'üíß',
                        modules: [
                            { id: 101, title: 'Introdu√ß√£o aos √ìleos Essenciais', duration: '15 min', videoUrl: 'https://www.youtube.com/embed/dQw4w9WgXcQ' },
                            { id: 102, title: 'Plano de Compensa√ß√£o B√°sico', duration: '20 min', videoUrl: 'https://www.youtube.com/embed/oHg5SJYRHA0' },
                            { id: 103, title: 'Como Fazer uma Lista de Nomes', duration: '10 min', videoUrl: 'https://www.youtube.com/embed/tgbNymZ7vqY' }
                        ]
                    },
                    {
                        id: 2,
                        name: 'Desenvolvimento de Lideran√ßa',
                        description: 'Estrat√©gias avan√ßadas para construir e motivar sua equipe.',
                        icon: 'üëë',
                        modules: [
                            { id: 201, title: 'O Poder do Patroc√≠nio', duration: '30 min', videoUrl: 'https://www.youtube.com/embed/tgbNymZ7vqY' },
                            { id: 202, title: 'Duplica√ß√£o Eficaz', duration: '25 min', videoUrl: 'https://www.youtube.com/embed/oHg5SJYRHA0' }
                        ]
                    }
                ];
                saveTrainingPathsToStorage();
            }
        }

        // Fun√ß√£o para salvar trilhas no localStorage
        function saveTrainingPathsToStorage() {
            localStorage.setItem('trainingPaths', JSON.stringify(trainingPaths));
        }

        // Fun√ß√£o para carregar progresso do usu√°rio
        function loadUserProgress(username) {
            const progressKey = `progress_${username}`;
            const savedProgress = localStorage.getItem(progressKey);
            return savedProgress ? JSON.parse(savedProgress) : {};
        }

        // Fun√ß√£o para salvar progresso do usu√°rio
        function saveUserProgress(username, progress) {
            const progressKey = `progress_${username}`;
            localStorage.setItem(progressKey, JSON.stringify(progress));
        }

        // --- Fun√ß√µes de Gerenciamento de Usu√°rios (Admin) ---

        // Fun√ß√£o para obter todos os usu√°rios
        function getAllUsers() {
            return systemUsers;
        }

        // Fun√ß√£o para adicionar novo usu√°rio
        function addUser(userData) {
            const users = getAllUsers();
            
            // Verificar se username j√° existe
            if (users.some(u => u.username === userData.username)) {
                return { success: false, message: 'Nome de usu√°rio j√° existe!' };
            }
            
            // Verificar se email j√° existe
            if (users.some(u => u.email === userData.email)) {
                return { success: false, message: 'E-mail j√° cadastrado!' };
            }
            
            const newUser = {
                id: Date.now(),
                username: userData.username,
                password: userData.password,
                name: userData.name,
                email: userData.email,
                role: userData.role
            };
            
            users.push(newUser);
            saveUsers(users);
            systemUsers = users; // Atualiza a vari√°vel global
            
            return { success: true, message: 'Usu√°rio adicionado com sucesso!', user: newUser };
        }

        // Fun√ß√£o para atualizar usu√°rio
        function updateUser(userId, userData) {
            const users = getAllUsers();
            const index = users.findIndex(u => u.id === userId);
            
            if (index === -1) {
                return { success: false, message: 'Usu√°rio n√£o encontrado!' };
            }
            
            // Verificar se username j√° existe em outro usu√°rio
            if (users.some(u => u.username === userData.username && u.id !== userId)) {
                return { success: false, message: 'Nome de usu√°rio j√° existe!' };
            }
            
            // Verificar se email j√° existe em outro usu√°rio
            if (users.some(u => u.email === userData.email && u.id !== userId)) {
                return { success: false, message: 'E-mail j√° cadastrado!' };
            }
            
            // Atualizar dados do usu√°rio
            users[index] = {
                ...users[index],
                username: userData.username,
                password: userData.password,
                name: userData.name,
                email: userData.email,
                role: userData.role
            };
            
            saveUsers(users);
            systemUsers = users; // Atualiza a vari√°vel global
            
            return { success: true, message: 'Usu√°rio atualizado com sucesso!', user: users[index] };
        }

        // Fun√ß√£o para excluir usu√°rio
        function deleteUser(userId) {
            const users = getAllUsers();
            const user = users.find(u => u.id === userId);
            
            if (!user) {
                return { success: false, message: 'Usu√°rio n√£o encontrado!' };
            }
            
            // N√£o permitir excluir o pr√≥prio usu√°rio logado
            if (currentUser && currentUser.id === userId) {
                return { success: false, message: 'Voc√™ n√£o pode excluir seu pr√≥prio usu√°rio!' };
            }
            
            const filteredUsers = users.filter(u => u.id !== userId);
            saveUsers(filteredUsers);
            systemUsers = filteredUsers; // Atualiza a vari√°vel global
            
            return { success: true, message: 'Usu√°rio exclu√≠do com sucesso!' };
        }

        // Fun√ß√£o para obter progresso de um usu√°rio espec√≠fico
        function getUserProgressData(username) {
            const progressKey = `progress_${username}`;
            const savedProgress = localStorage.getItem(progressKey);
            return savedProgress ? JSON.parse(savedProgress) : {};
        }

        // --- Fun√ß√µes de Renderiza√ß√£o e L√≥gica da Aplica√ß√£o ---

        // Manipular login
        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username || !password) {
                alert('Por favor, preencha usu√°rio e senha!');
                return;
            }
            
            // Autenticar usando o sistema de gerenciamento de usu√°rios
            const user = authenticateUser(username, password);
            
            if (user) {
                currentUser = {
                    id: user.id,
                    username: user.username,
                    name: user.name,
                    email: user.email,
                    isAdmin: user.role === 'admin'
                };
                isAdmin = currentUser.isAdmin;
                updateAdminNav();
                
                // Carregar progresso do usu√°rio
                currentUser.progress = loadUserProgress(currentUser.username);

                // CORRE√á√ÉO: Corrigir chaves num√©ricas antigas para strings
                for (const pathId in currentUser.progress) {
                    const pathProgress = currentUser.progress[pathId];
                    for (const key in pathProgress) {
                        if (typeof key === 'string' && !isNaN(key)) {
                            pathProgress[String(key)] = pathProgress[key];
                            delete pathProgress[key];
                        }
                    }
                }
                
                // Atualizar interface
                document.querySelector('.user-info span').textContent = currentUser.name;
                document.querySelector('.user-avatar').textContent = currentUser.name.charAt(0);
                document.querySelector('.welcome-message h1').textContent = `Bem-vindo(a), ${currentUser.name.split(' ')[0]}!`;
                
                // Mostrar/ocultar painel admin
                adminPanel.style.display = isAdmin ? 'block' : 'none';
                
                // Alternar entre p√°ginas
                loginPage.style.display = 'none';
                app.style.display = 'block';
                
                // Renderizar trilhas atualizadas
                renderTrainingPaths();
                renderAdminPathsList();
                renderDashboardStats(); // Renderiza as estat√≠sticas do dashboard
                
                // Se for admin, renderizar lista de usu√°rios
                if (isAdmin) {
                    renderUsersList();
                    renderAdminRankingList();
                }
            } else {
                alert('Usu√°rio ou senha inv√°lidos!');
            }
        }

        // Login administrativo (Corre√ß√£o B-01 e UX-01)
        function handleAdminLogin(e) {
            e.preventDefault();
            document.getElementById('username').value = 'admin';
            document.getElementById('password').value = 'admin';
            // loadPage('login-page'); // Removido: fun√ß√£o inexistente e desnecess√°ria
            // updateAdminNav(); // Removido: chamada fora de contexto
        }
        
        function handleLogout() {
            currentUser = null;
            isAdmin = false;
            loginPage.style.display = 'flex';
            app.style.display = 'none';
            document.getElementById('login-form').reset();
            updateAdminNav();
            // Volta para a dashboard (que estar√° oculta, mas o link ativo deve ser resetado)
            handleNavigation({ preventDefault: () => {}, target: document.querySelector('.nav-link[data-page="dashboard"]') });
        }

        // Manipular navega√ß√£o (Corre√ß√£o B-02)
        function handleNavigation(e) {
            e.preventDefault();
            const targetPage = e.target.getAttribute('data-page') || e.target.closest('.nav-link').getAttribute('data-page');
            
            // Atualizar navega√ß√£o ativa
            navLinks.forEach(link => {
                link.classList.remove('active');
            });
            
            // Garantir que o elemento clicado (ou seu pai, se for um √≠cone) receba a classe 'active'
            let targetLink = e.target.closest('.nav-link');
            if (targetLink) {
                targetLink.classList.add('active');
            }
            
            // Mostrar p√°gina selecionada
            pages.forEach(page => {
                page.style.display = 'none';
            });
            document.getElementById(`${targetPage}-page`).style.display = 'block';

            // A√ß√µes espec√≠ficas por p√°gina
            if (targetPage === 'dashboard') {
                renderDashboardStats();
                renderTrainingPaths();
            } else if (targetPage === 'ranking') {
                renderRankingCards();
            } else if (targetPage === 'certificates') {
                renderCertificates();
            }
        }

        // Mostrar modal para nova trilha
        function showNewPathModal() {
            editingPathId = null;
            document.getElementById('modal-title').textContent = 'Nova Trilha';
            document.getElementById('path-id').value = '';
            document.getElementById('path-name').value = '';
            document.getElementById('path-description').value = '';
            document.getElementById('path-icon').value = '';
            modulesContainer.innerHTML = '';
            
            // Adicionar um m√≥dulo vazio por padr√£o
            addModuleForm();
            
            pathModal.style.display = 'flex';
        }

        // Mostrar modal para editar trilha
        function showEditPathModal(pathId) {
            const path = trainingPaths.find(p => String(p.id) === String(pathId));
            if (!path) return;
            
            editingPathId = pathId;
            document.getElementById('modal-title').textContent = 'Editar Trilha';
            document.getElementById('path-id').value = path.id;
            document.getElementById('path-name').value = path.name;
            document.getElementById('path-description').value = path.description;
            document.getElementById('path-icon').value = path.icon;
            
            // Limpar m√≥dulos existentes
            modulesContainer.innerHTML = '';
            
            // Adicionar m√≥dulos da trilha
            path.modules.forEach(module => {
                addModuleForm(module);
            });
            
            pathModal.style.display = 'flex';
        }

        // Ocultar modal
        function hidePathModal() {
            pathModal.style.display = 'none';
        }

        // Adicionar formul√°rio de m√≥dulo
        function addModuleForm(module = null) {
            const moduleId = module ? module.id : String(Date.now());
            const moduleHtml = `
                <div class="module-item-form" data-module-id="${moduleId}">
                    <div class="module-item-header">
                        <div class="module-item-title">M√≥dulo</div>
                        <button type="button" class="remove-module">&times;</button>
                    </div>
                    <div class="form-group">
                        <label>T√≠tulo</label>
                        <input type="text" class="form-control module-title" value="${module ? module.title : ''}" required>
                    </div>
                    <div class="form-group">
                        <label>Dura√ß√£o</label>
                        <input type="text" class="form-control module-duration" value="${module ? module.duration : ''}" placeholder="Ex: 15 min" required>
                    </div>
                    <div class="form-group">
                        <label>Link do V√≠deo</label>
                        <input type="url" class="form-control module-video" value="${module ? module.videoUrl : ''}" placeholder="https://..." required>
                    </div>
                    <div class="form-group">
                        <label>Descri√ß√£o</label>
                        <textarea class="form-control module-description" rows="2" required>${module ? module.description : ''}</textarea>
                    </div>
                </div>
            `;
            
            modulesContainer.insertAdjacentHTML('beforeend', moduleHtml);
            
            // Adicionar event listener para remover m√≥dulo
            const newModule = modulesContainer.lastElementChild;
            const removeBtn = newModule.querySelector('.remove-module');
            removeBtn.addEventListener('click', function() {
                if (modulesContainer.children.length > 1) {
                    newModule.remove();
                } else {
                    alert('A trilha deve ter pelo menos um m√≥dulo.');
                }
            });
        }

        // Salvar trilha (criar ou editar)
        function savePath() {
            // Validar formul√°rio
            if (!pathForm.checkValidity()) {
                alert('Por favor, preencha todos os campos obrigat√≥rios.');
                return;
            }
            
            // Coletar dados do formul√°rio
            const pathId = editingPathId || String(Date.now());
            const pathName = document.getElementById('path-name').value;
            const pathDescription = document.getElementById('path-description').value;
            const pathIcon = document.getElementById('path-icon').value;
            
            // Coletar m√≥dulos
            const modules = [];
            const moduleForms = modulesContainer.querySelectorAll('.module-item-form');
            
            moduleForms.forEach(form => {
                const title = form.querySelector('.module-title').value;
                const duration = form.querySelector('.module-duration').value;
                const videoUrl = form.querySelector('.module-video').value;
                const description = form.querySelector('.module-description').value;
                
                modules.push({
                    id: form.dataset.moduleId,
                    title,
                    duration,
                    videoUrl,
                    description
                });
            });
            
            // Criar ou atualizar trilha
            if (editingPathId) {
                // Atualizar trilha existente
                const index = trainingPaths.findIndex(p => String(p.id) === String(editingPathId));
                if (index !== -1) {
                    trainingPaths[index] = {
                        id: editingPathId,
                        name: pathName,
                        description: pathDescription,
                        icon: pathIcon,
                        modules
                    };
                }
            } else {
                // Adicionar nova trilha
                trainingPaths.push({
                    id: pathId,
                    name: pathName,
                    description: pathDescription,
                    icon: pathIcon,
                    modules
                });
            }
            
            // Salvar no localStorage
            saveTrainingPathsToStorage();
            
            // Atualizar interface
            renderTrainingPaths();
            renderAdminPathsList();
            
            // Fechar modal
            hidePathModal();
        }

        // Excluir trilha
        function deletePath(pathId) {
            if (confirm('Tem certeza que deseja excluir esta trilha?')) {
                trainingPaths = trainingPaths.filter(p => String(p.id) !== String(pathId));
                saveTrainingPathsToStorage();
                renderTrainingPaths();
                renderAdminPathsList();
            }
        }

        // Exportar trilhas para JSON
        function exportTrainingPaths() {
            const dataStr = JSON.stringify(trainingPaths, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'trilhas-alcateia.json';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // Importar trilhas de JSON
        function importTrainingPaths(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedPaths = JSON.parse(e.target.result);
                    if (Array.isArray(importedPaths)) {
                        trainingPaths = importedPaths;
                        saveTrainingPathsToStorage();
                        renderTrainingPaths();
                        renderAdminPathsList();
                        alert('Trilhas importadas com sucesso!');
                    } else {
                        alert('Arquivo inv√°lido. Certifique-se de que √© um JSON v√°lido.');
                    }
                } catch (error) {
                    alert('Erro ao importar arquivo: ' + error.message);
                }
            };
            reader.readAsText(file);
            
            // Limpar input para permitir reimporta√ß√£o do mesmo arquivo
            e.target.value = '';
        }

        // Renderizar trilhas na interface do usu√°rio
        function renderTrainingPaths() {
            // Dashboard
            dashboardPaths.innerHTML = '';
            trainingPaths.forEach(path => {
                const completedModules = getCompletedModulesCount(path.id);
                const totalModules = path.modules.length;
                const progressPercentage = totalModules > 0 ? Math.round((completedModules / totalModules) * 100) : 0;
                
                const pathHtml = `
                    <div class="path-card">
                        <div class="path-header">
                            <div class="path-icon">${path.icon}</div>
                            <div class="path-title">${path.name}</div>
                        </div>
                        <div class="path-content">
                            <div class="path-description">${path.description}</div>
                            <div class="path-stats">
                                <span>${completedModules}/${totalModules} m√≥dulos</span>
                                <span>${calculateTotalDuration(path.modules)}</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                            </div>
                            <button class="path-btn" data-path-id="${String(path.id)}">Continuar Trilha</button>
                        </div>
                    </div>
                `;
                dashboardPaths.insertAdjacentHTML('beforeend', pathHtml);
            });
            
            // P√°gina de treinamentos
            trainingPathsContainer.innerHTML = '';
            trainingPaths.forEach(path => {
                const completedModules = getCompletedModulesCount(path.id);
                const totalModules = path.modules.length;
                const progressPercentage = totalModules > 0 ? Math.round((completedModules / totalModules) * 100) : 0;
                
                const pathHtml = `
                    <div class="path-card">
                        <div class="path-header">
                            <div class="path-icon">${path.icon}</div>
                            <div class="path-title">${path.name}</div>
                        </div>
                        <div class="path-content">
                            <div class="path-description">${path.description}</div>
                            <div class="path-stats">
                                <span>${completedModules}/${totalModules} m√≥dulos</span>
                                <span>${calculateTotalDuration(path.modules)}</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                            </div>
                            <button class="path-btn" data-path-id="${String(path.id)}">Iniciar Trilha</button>
                        </div>
                    </div>
                `;
                trainingPathsContainer.insertAdjacentHTML('beforeend', pathHtml);
            });
            
            // Adicionar event listeners aos bot√µes
            document.querySelectorAll('.path-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const pathId = parseInt(this.getAttribute('data-path-id'));
                    openTrainingPath(pathId);
                });
            });
        }

        // Renderizar lista de trilhas no painel administrativo
        function renderAdminPathsList() {
            adminPathsList.innerHTML = '';
            trainingPaths.forEach(path => {
                const pathHtml = `
                    <div class="admin-path-item">
                        <div class="admin-path-info">
                            <div class="admin-path-icon">${path.icon}</div>
                            <div>
                                <div class="admin-path-title">${path.name}</div>
                                <div>${path.modules.length} m√≥dulos</div>
                            </div>
                        </div>
                        <div class="admin-path-actions">
                            <button class="btn btn-secondary edit-path" data-path-id="${String(path.id)}">Editar</button>
                            <button class="btn btn-danger delete-path" data-path-id="${String(path.id)}">Excluir</button>
                        </div>
                    </div>
                `;
                adminPathsList.insertAdjacentHTML('beforeend', pathHtml);
            });
            
            // Adicionar event listeners aos bot√µes
            document.querySelectorAll('.edit-path').forEach(btn => {
                btn.addEventListener('click', function() {
                    const pathId = parseInt(this.getAttribute('data-path-id'));
                    showEditPathModal(pathId);
                });
            });
            
            document.querySelectorAll('.delete-path').forEach(btn => {
                btn.addEventListener('click', function() {
                    const pathId = parseInt(this.getAttribute('data-path-id'));
                    deletePath(pathId);
                });
            });
        }

        // Calcular dura√ß√£o total dos m√≥dulos
        function calculateTotalDuration(modules) {
            let totalMinutes = 0;
            modules.forEach(module => {
                const match = module.duration.match(/(\d+)\s*min/);
                if (match) {
                    totalMinutes += parseInt(match[1]);
                }
            });
            
            if (totalMinutes < 60) {
                return `${totalMinutes} min`;
            } else {
                const hours = Math.floor(totalMinutes / 60);
                const minutes = totalMinutes % 60;
                return minutes > 0 ? `${hours}h${minutes}min` : `${hours}h`;
            }
        }

        // Obter contagem de m√≥dulos conclu√≠dos para uma trilha
        function getCompletedModulesCount(pathId) {
            if (!currentUser || !currentUser.progress || !currentUser.progress[pathId]) {
                return 0;
            }
            
            return Object.values(currentUser.progress[pathId]).filter(isCompleted => isCompleted).length;
        }

        // Verificar se um m√≥dulo espec√≠fico est√° conclu√≠do
        function isModuleCompleted(pathId, moduleId) {
            if (!currentUser || !currentUser.progress || !currentUser.progress[pathId]) {
                return false;
            }
            
            return currentUser.progress[pathId][String(moduleId)] === true; // CORRE√á√ÉO: Usar String(moduleId) para compatibilidade com localStorage
        }

        // Abrir trilha de treinamento
        function openTrainingPath(pathId) {
            const path = trainingPaths.find(p => String(p.id) === String(pathId));
            if (!path) return;
            
            currentPath = path;
            
            // Atualizar informa√ß√µes da trilha
            document.getElementById('training-path-title').textContent = path.name;
            document.getElementById('training-path-description').textContent = path.description;
            
            // Atualizar indicador de progresso
            updatePathProgressIndicator(pathId);
            
            // Renderizar m√≥dulos
            const modulesList = document.querySelector('#modules-list');
            modulesList.innerHTML = '';
            
            path.modules.forEach((module, index) => {
                const isCompleted = isModuleCompleted(pathId, module.id);
                const moduleHtml = `
                    <div class="module-item ${index === 0 ? 'active' : ''} ${isCompleted ? 'completed' : ''}" data-module-id="${String(module.id)}">
                        <div class="module-info">
                            <div class="module-title">${module.title}</div>
                            <div class="module-duration">${module.duration}</div>
                        </div>
                        <div class="module-status ${isCompleted ? 'completed' : ''}">${isCompleted ? '‚úì' : (index === 0 ? '‚ñ∂' : '')}</div>
                    </div>
                `;
                modulesList.insertAdjacentHTML('beforeend', moduleHtml);
            });
            
            // Adicionar event listeners aos m√≥dulos
            document.querySelectorAll('.module-item').forEach(item => {
                item.addEventListener('click', function() {
                    // Remover classe active de todos os m√≥dulos
                    document.querySelectorAll('.module-item').forEach(m => {
                        m.classList.remove('active');
                        if (!m.classList.contains('completed')) {
                            m.querySelector('.module-status').textContent = '';
                        }
                    });
                    
                    // Adicionar classe active ao m√≥dulo clicado
                    this.classList.add('active');
                    if (!this.classList.contains('completed')) {
                        this.querySelector('.module-status').textContent = '‚ñ∂';
                    }
                    
                    // Carregar v√≠deo do m√≥dulo
                    const moduleId = this.getAttribute('data-module-id');
                    loadModuleVideo(moduleId, path);
                });
            });
            
            // Carregar primeiro v√≠deo
            if (path.modules.length > 0) {
                loadModuleVideo(String(path.modules[0].id), path);
            }
            
            // Mostrar p√°gina de conte√∫do de treinamento
            pages.forEach(page => {
                page.style.display = 'none';
            });
            document.getElementById('training-content-page').style.display = 'block';
            
            // Atualizar navega√ß√£o (remover ativo da nav principal)
            navLinks.forEach(link => {
                link.classList.remove('active');
            });
        }

        // Carregar v√≠deo do m√≥dulo
        function loadModuleVideo(moduleId, path) {
            const module = path.modules.find(m => String(m.id) === String(moduleId));
            if (!module) return;
            
            currentModule = module;
            
            // Atualizar informa√ß√µes do v√≠deo
            document.getElementById('video-title').textContent = module.title;
            document.getElementById('video-description').textContent = module.description;
            
            // Atualizar bot√£o de concluir m√≥dulo
            updateCompleteModuleButton(path.id, moduleId);
            
            // Atualizar player de v√≠deo
            const videoPlayer = document.getElementById('video-player');
            videoPlayer.innerHTML = `
                <iframe width="100%" height="100%" src="${module.videoUrl}" 
                    frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen></iframe>
            `;
            
            // Mostrar container do v√≠deo
            document.getElementById('video-container').style.display = 'block';
        }

        // Atualizar bot√£o de concluir m√≥dulo
        function updateCompleteModuleButton(pathId, moduleId) {
            const isCompleted = isModuleCompleted(pathId, moduleId);
            
            if (isCompleted) {
                completeModuleBtn.classList.add('completed');
                completeModuleText.textContent = 'Conclu√≠do ‚úÖ';
            } else {
                completeModuleBtn.classList.remove('completed');
                completeModuleText.textContent = 'Marcar como conclu√≠do';
            }
        }

        // Alternar estado de conclus√£o do m√≥dulo (Corre√ß√£o B-03)
        function toggleModuleCompletion() {
            if (!currentUser || !currentPath || !currentModule) return;
            
            const pathId = currentPath.id;
            const moduleId = currentModule.id;
            const isCompleted = isModuleCompleted(pathId, moduleId);
            
            // Inicializar progresso do usu√°rio se necess√°rio
            if (!currentUser.progress) {
                currentUser.progress = {};
            }
            if (!currentUser.progress[pathId]) {
                currentUser.progress[pathId] = {};
            }
            
            // Alternar estado de conclus√£o
            currentUser.progress[pathId][String(moduleId)] = !isCompleted; // CORRE√á√ÉO: Usar String(moduleId) para salvar o progresso corretamente
            
            // Salvar progresso
            saveUserProgress(currentUser.username, currentUser.progress);
            
            // Atualizar interface
            updateCompleteModuleButton(pathId, moduleId);
            updatePathProgressIndicator(pathId);
            
            // Atualizar lista de m√≥dulos
            const moduleItem = document.querySelector(`.module-item[data-module-id="${String(moduleId)}"]`);
            if (moduleItem) {
                if (currentUser.progress[pathId][String(moduleId)]) {
                    moduleItem.classList.add('completed');
                    moduleItem.querySelector('.module-status').textContent = '‚úì';
                } else {
                    moduleItem.classList.remove('completed');
                    // Manter o '‚ñ∂' se for o m√≥dulo ativo
                    if (moduleItem.classList.contains('active')) {
                        moduleItem.querySelector('.module-status').textContent = '‚ñ∂';
                    } else {
                        moduleItem.querySelector('.module-status').textContent = '';
                    }
                }
            }
            
            // Atualizar trilhas no dashboard (Removido: renderTrainingPaths() para evitar recarregar o v√≠deo - Bug B-03)
            // renderTrainingPaths();
        }

        // Atualizar indicador de progresso da trilha
        function updatePathProgressIndicator(pathId) {
            if (!currentPath) return;
            
            const completedModules = getCompletedModulesCount(pathId);
            const totalModules = currentPath.modules.length;
            const progressPercentage = totalModules > 0 ? Math.round((completedModules / totalModules) * 100) : 0;
            
            pathProgressText.textContent = `${completedModules} de ${totalModules} m√≥dulos conclu√≠dos`;
            pathProgressFill.style.width = `${progressPercentage}%`;
            pathProgressPercent.textContent = `${progressPercentage}%`;
        }

        // Renderizar estat√≠sticas do Dashboard (Corre√ß√£o UX-02)
        function renderDashboardStats() {
            const statsContainer = document.getElementById('stats-cards');
            statsContainer.innerHTML = '';
            
            if (!currentUser || !currentUser.progress || Object.keys(currentUser.progress).length === 0) {
                // Estado inicial ou sem progresso
                statsContainer.innerHTML = `
                    <div class="stat-card">
                        <h3>Progresso Geral</h3>
                        <div class="stat-value">0%</div>
                        <div class="progress-bar"><div class="progress-fill" style="width: 0%;"></div></div>
                        <div class="stat-description">Comece sua primeira trilha para ver seu progresso aqui!</div>
                    </div>
                    <div class="stat-card">
                        <h3>Trilha Atual</h3>
                        <div class="stat-value">Nenhuma</div>
                        <div class="stat-description">Selecione uma trilha abaixo para come√ßar.</div>
                    </div>
                    <div class="stat-card">
                        <h3>Horas de Estudo</h3>
                        <div class="stat-value">0h</div>
                        <div class="stat-description">Tempo total dedicado ao treinamento.</div>
                    </div>
                    <div class="stat-card">
                        <h3>Pr√≥xima Meta</h3>
                        <div class="stat-value">Come√ßar!</div>
                        <div class="stat-description">Conclua o primeiro m√≥dulo de qualquer trilha.</div>
                    </div>
                `;
                return;
            }

            // L√≥gica para calcular estat√≠sticas reais (mantida a estrutura original, mas com os novos valores de estado vazio)
            let totalModules = 0;
            let completedModules = 0;
            let totalDurationMinutes = 0;
            let currentPathName = 'Nenhuma';
            let nextGoal = 'Conclua o primeiro m√≥dulo de qualquer trilha.';

            trainingPaths.forEach(path => {
                totalModules += path.modules.length;
                completedModules += getCompletedModulesCount(path.id);
                
                // C√°lculo de dura√ß√£o total (simplificado para demonstra√ß√£o)
                path.modules.forEach(module => {
                    const match = module.duration.match(/(\d+)\s*min/);
                    if (match) {
                        totalDurationMinutes += parseInt(match[1]);
                    }
                });

                // L√≥gica para Trilha Atual e Pr√≥xima Meta (simplificada)
                if (currentUser.progress[path.id] && getCompletedModulesCount(path.id) < path.modules.length) {
                    currentPathName = path.name;
                    const nextModule = path.modules.find(module => !isModuleCompleted(path.id, module.id));
                    if (nextModule) {
                        nextGoal = `Conclua o m√≥dulo: ${nextModule.title} da Trilha ${path.name}.`;
                    }
                }
            });

            const progressPercentage = totalModules > 0 ? Math.round((completedModules / totalModules) * 100) : 0;
            const totalHours = Math.floor(totalDurationMinutes / 60);
            const remainingMinutes = totalDurationMinutes % 60;
            const totalDurationText = totalHours > 0 ? `${totalHours}h${remainingMinutes}min` : `${totalDurationMinutes} min`;

            statsContainer.innerHTML = `
                <div class="stat-card">
                    <h3>Progresso Geral</h3>
                    <div class="stat-value">${progressPercentage}%</div>
                    <div class="progress-bar"><div class="progress-fill" style="width: ${progressPercentage}%;"></div></div>
                    <div class="stat-description">${completedModules} de ${totalModules} m√≥dulos conclu√≠dos.</div>
                </div>
                <div class="stat-card">
                    <h3>Trilha Atual</h3>
                    <div class="stat-value">${currentPathName}</div>
                    <div class="stat-description">Trilha em que voc√™ est√° focado(a) no momento.</div>
                </div>
                <div class="stat-card">
                    <h3>Horas de Estudo</h3>
                    <div class="stat-value">${totalDurationText}</div>
                    <div class="stat-description">Tempo total dedicado ao treinamento.</div>
                </div>
                <div class="stat-card">
                    <h3>Pr√≥xima Meta</h3>
                    <div class="stat-value">${nextGoal.split(':')[0]}</div>
                    <div class="stat-description">${nextGoal}</div>
                </div>
            `;
        }

        // --- Fun√ß√µes de Gerenciamento de Ranking ---

        const RANKING_STORAGE_KEY = 'consultoresRanking';
        let consultoresRanking = [];

        // Fun√ß√£o para carregar consultores do localStorage
        function loadConsultores() {
            const consultoresJson = localStorage.getItem(RANKING_STORAGE_KEY);
            if (consultoresJson) {
                consultoresRanking = JSON.parse(consultoresJson);
            } else {
                // Dados de ranking padr√£o (apenas para demonstra√ß√£o)
                consultoresRanking = [
                    { id: 1, name: 'Jo√£o Silva', ranking: 'Diamante', description: 'Lideran√ßa inspiradora e resultados consistentes.', photoUrl: 'https://via.placeholder.com/100/d4af37/2c2c2c?text=JS' },
                    { id: 2, name: 'Maria Oliveira', ranking: 'Ouro', description: 'Especialista em recrutamento e reten√ß√£o.', photoUrl: 'https://via.placeholder.com/100/d4af37/2c2c2c?text=MO' },
                    { id: 3, name: 'Pedro Souza', ranking: 'Prata', description: 'Foco em bem-estar e sa√∫de integral.', photoUrl: 'https://via.placeholder.com/100/d4af37/2c2c2c?text=PS' }
                ];
                saveConsultores();
            }
        }

        // Fun√ß√£o para salvar consultores no localStorage
        function saveConsultores() {
            localStorage.setItem(RANKING_STORAGE_KEY, JSON.stringify(consultoresRanking));
        }

        // Renderizar cards de ranking
        function renderRankingCards() {
            const container = document.getElementById('ranking-cards-container');
            container.innerHTML = '';
            
            consultoresRanking.forEach(consultor => {
                const cardHtml = `
                    <div class="consultor-card">
                        <img src="${consultor.photoUrl || 'https://via.placeholder.com/100/d4af37/2c2c2c?text=?'}" alt="${consultor.name}" class="consultor-card-photo">
                        <div class="consultor-card-name">${consultor.name}</div>
                        <div class="consultor-card-ranking">${consultor.ranking}</div>
                        <div class="consultor-card-description">${consultor.description}</div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', cardHtml);
            });
        }

        // Renderizar lista de ranking no painel administrativo
        function renderAdminRankingList() {
            const container = document.getElementById('admin-ranking-list-container');
            container.innerHTML = '';
            
            let html = '<ul class="admin-ranking-list">';
            consultoresRanking.forEach(consultor => {
                html += `
                    <li class="admin-ranking-item">
                        <div class="admin-ranking-info">
                            <img src="${consultor.photoUrl || 'https://via.placeholder.com/40/d4af37/2c2c2c?text=?'}" alt="${consultor.name}" class="ranking-avatar">
                            <div>
                                <strong>${consultor.name}</strong>
                                <small>(${consultor.ranking})</small>
                            </div>
                        </div>
                        <div class="admin-ranking-actions">
                            <button class="btn btn-secondary edit-consultor" data-id="${consultor.id}">Editar</button>
                            <button class="btn btn-danger delete-consultor" data-id="${consultor.id}">Excluir</button>
                        </div>
                    </li>
                `;
            });
            html += '</ul>';
            container.innerHTML = html;

            // Adicionar event listeners
            document.querySelectorAll('.edit-consultor').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    showEditConsultorForm(id);
                });
            });

            document.querySelectorAll('.delete-consultor').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteConsultor(id);
                });
            });
        }

        // Mostrar formul√°rio de edi√ß√£o/adi√ß√£o de consultor (Corre√ß√£o UX-03)
        function showNewConsultorForm() {
            document.getElementById('ranking-modal-title').textContent = 'Adicionar Novo Consultor';
            document.getElementById('consultor-id').value = '';
            document.getElementById('consultor-form').reset();
            document.getElementById('cancel-edit-consultor').style.display = 'none';
            document.getElementById('ranking-modal').style.display = 'flex';
        }

        function showEditConsultorForm(id) {
            const consultor = consultoresRanking.find(c => c.id === id);
            if (!consultor) return;

            document.getElementById('ranking-modal-title').textContent = 'Editar Consultor';
            document.getElementById('consultor-id').value = consultor.id;
            document.getElementById('consultor-name').value = consultor.name;
            document.getElementById('consultor-ranking').value = consultor.ranking;
            document.getElementById('consultor-description').value = consultor.description;
            document.getElementById('consultor-photo').value = consultor.photoUrl || '';
            document.getElementById('cancel-edit-consultor').style.display = 'inline-block';
            document.getElementById('ranking-modal').style.display = 'flex';
        }

        function saveConsultor(e) {
            e.preventDefault();
            const id = document.getElementById('consultor-id').value ? parseInt(document.getElementById('consultor-id').value) : null;
            const name = document.getElementById('consultor-name').value;
            const ranking = document.getElementById('consultor-ranking').value;
            const description = document.getElementById('consultor-description').value;
            const photoUrl = document.getElementById('consultor-photo').value;

            if (id) {
                // Edi√ß√£o
                const index = consultoresRanking.findIndex(c => c.id === id);
                if (index !== -1) {
                    consultoresRanking[index] = { id, name, ranking, description, photoUrl };
                }
            } else {
                // Adi√ß√£o
                const newId = Date.now();
                consultoresRanking.push({ id: newId, name, ranking, description, photoUrl });
            }

            saveConsultores();
            renderRankingCards();
            renderAdminRankingList();
            closeRankingModal();
        }

        function deleteConsultor(id) {
            if (confirm('Tem certeza que deseja excluir este consultor do ranking?')) {
                consultoresRanking = consultoresRanking.filter(c => c.id !== id);
                saveConsultores();
                renderRankingCards();
                renderAdminRankingList();
            }
        }

        function closeRankingModal() {
            document.getElementById('ranking-modal').style.display = 'none';
            document.getElementById('consultor-form').reset();
            document.getElementById('cancel-edit-consultor').style.display = 'none';
        }

        // --- Fun√ß√µes de Certificados ---

        // Renderizar certificados (simula√ß√£o)
        function renderCertificates() {
            const container = document.getElementById('certificates-grid');
            container.innerHTML = '';

            // Simula√ß√£o de certificados baseados em trilhas conclu√≠das
            const completedPaths = trainingPaths.filter(path => getCompletedModulesCount(path.id) === path.modules.length);

            if (completedPaths.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #aaa;">Nenhum certificado dispon√≠vel. Conclua uma trilha para obter seu certificado!</p>';
                return;
            }

            completedPaths.forEach(path => {
                const certificateHtml = `
                    <div class="certificate-card">
                        <span class="certificate-icon">üèÖ</span>
                        <div class="certificate-title">Certificado de Conclus√£o</div>
                        <div class="certificate-date">Trilha: ${path.name}</div>
                        <button class="download-btn">Baixar PDF</button>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', certificateHtml);
            });
        }

        // --- Fun√ß√µes de Event Listeners e Inicializa√ß√£o ---

        function updateAdminNav() {
            // L√≥gica para mostrar/ocultar itens de navega√ß√£o de admin, se houver
        }

        function init() {
            loadUsers();
            loadTrainingPaths();
            loadConsultores();

            // Event Listeners
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
            document.getElementById('admin-login-link').addEventListener('click', handleAdminLogin);
            
            navLinks.forEach(link => {
                link.addEventListener('click', handleNavigation);
            });

            // Admin Paths
            document.getElementById('new-path-btn').addEventListener('click', showNewPathModal);
            document.getElementById('add-module-btn').addEventListener('click', () => addModuleForm());
            pathForm.addEventListener('submit', function(e) {
                e.preventDefault();
                savePath();
            });
            document.getElementById('export-paths-btn').addEventListener('click', exportTrainingPaths);
            document.getElementById('import-paths-btn').addEventListener('click', () => document.getElementById('import-paths-input').click());
            document.getElementById('import-paths-input').addEventListener('change', importTrainingPaths);

            // Training Content
            document.getElementById('back-to-training-btn').addEventListener('click', function() {
                handleNavigation({ preventDefault: () => {}, target: document.querySelector('.nav-link[data-page="training"]') });
            });
            completeModuleBtn.addEventListener('click', toggleModuleCompletion);

            // Admin Users
            document.getElementById('new-user-btn').addEventListener('click', function() {
                document.getElementById('user-modal-title').textContent = 'Novo Usu√°rio';
                document.getElementById('user-id').value = '';
                document.getElementById('user-form').reset();
                document.getElementById('user-modal').style.display = 'flex';
            });
            document.getElementById('user-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveUser();
            });

            // Admin Ranking
            document.getElementById('new-consultor-btn').addEventListener('click', showNewConsultorForm);
            document.getElementById('consultor-form').addEventListener('submit', saveConsultor);
            document.getElementById('cancel-edit-consultor').addEventListener('click', closeRankingModal);
            
            // Inicializa a visualiza√ß√£o correta (se j√° estiver logado, o que n√£o deve acontecer no prot√≥tipo, mas por seguran√ßa)
            if (currentUser) {
                app.style.display = 'block';
                loginPage.style.display = 'none';
                renderTrainingPaths();
                renderDashboardStats();
                if (isAdmin) {
                    renderUsersList();
                    renderAdminRankingList();
                }
            } else {
                loginPage.style.display = 'flex';
                app.style.display = 'none';
            }
        }

        // Inicia a aplica√ß√£o
        init();

        // Fun√ß√µes auxiliares para o Admin Users (renderUsersList, saveUser, closeUserModal, confirmDeleteUser, viewUserProgress)
        // Estas fun√ß√µes est√£o no final do arquivo original e foram mantidas aqui para integridade, mas a l√≥gica de chamada foi ajustada no `init` e `handleLogin`.

        // Fun√ß√£o para renderizar lista de usu√°rios no painel admin
        function renderUsersList() {
            const users = getAllUsers();
            const container = document.getElementById('users-list-container');
            
            if (!container) return;
            
            if (users.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #aaa;">Nenhum usu√°rio cadastrado.</p>';
                return;
            }
            
            let html = '<table class="ranking-table" style="margin-top: 20px;">';
            html += '<thead><tr>';
            html += '<th>ID</th>';
            html += '<th>Nome</th>';
            html += '<th>Usu√°rio</th>';
            html += '<th>E-mail</th>';
            html += '<th>Tipo</th>';
            html += '<th>Progresso</th>';
            html += '<th>A√ß√µes</th>';
            html += '</tr></thead><tbody>';
            
            users.forEach(user => {
                const progress = getUserProgressData(user.username);
                const totalPaths = trainingPaths.length;
                let completedPaths = 0;
                
                // Calcular trilhas completas
                trainingPaths.forEach(path => {
                    if (progress[path.id]) {
                        const pathProgress = progress[path.id];
                        const totalModules = path.modules.length;
                        const completedModules = Object.keys(pathProgress).filter(k => pathProgress[k]).length;
                        if (completedModules === totalModules) {
                            completedPaths++;
                        }
                    }
                });
                
                const progressPercent = totalPaths > 0 ? Math.round((completedPaths / totalPaths) * 100) : 0;
                
                html += '<tr>';
                html += `<td>${user.id}</td>`;
                html += `<td>${user.name}</td>`;
                html += `<td>${user.username}</td>`;
                html += `<td>${user.email}</td>`;
                html += `<td>${user.role}</td>`;
                html += `<td>${progressPercent}%</td>`;
                html += `<td>
                            <button class="btn btn-secondary btn-sm" onclick="showEditUserModal(${user.id})">Editar</button>
                            <button class="btn btn-secondary btn-sm" onclick="viewUserProgress(${user.id})">Ver Progresso</button>
                            <button class="btn btn-danger btn-sm" onclick="confirmDeleteUser(${user.id})">Excluir</button>
                        </td>`;
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Fun√ß√£o para mostrar modal de edi√ß√£o de usu√°rio
        function showEditUserModal(userId) {
            const user = systemUsers.find(u => u.id === userId);
            if (!user) return;

            document.getElementById('user-modal-title').textContent = 'Editar Usu√°rio';
            document.getElementById('user-id').value = user.id;
            document.getElementById('user-name').value = user.name;
            document.getElementById('user-username').value = user.username;
            document.getElementById('user-email').value = user.email;
            document.getElementById('user-password').value = user.password; // Nota: Em produ√ß√£o, isso n√£o seria feito por seguran√ßa.
            document.getElementById('user-role').value = user.role;
            document.getElementById('user-modal').style.display = 'flex';
        }

        // Fun√ß√£o para salvar usu√°rio (adicionar ou editar)
        function saveUser() {
            const userId = document.getElementById('user-id').value;
            const username = document.getElementById('user-username').value.trim();
            const password = document.getElementById('user-password').value.trim();
            const name = document.getElementById('user-name').value.trim();
            const email = document.getElementById('user-email').value.trim();
            const role = document.getElementById('user-role').value;
            
            if (!username || !password || !name || !email) {
                alert('Por favor, preencha todos os campos!');
                return;
            }
            
            const userData = { username, password, name, email, role };
            let result;
            
            if (userId) {
                // Editar usu√°rio existente
                result = updateUser(parseInt(userId), userData);
            } else {
                // Adicionar novo usu√°rio
                result = addUser(userData);
            }
            
            if (result.success) {
                alert(result.message);
                closeUserModal();
                renderUsersList();
            } else {
                alert(result.message);
            }
        }

        // Fun√ß√£o para fechar modal de usu√°rio
        function closeUserModal() {
            document.getElementById('user-modal').style.display = 'none';
            document.getElementById('user-form').reset();
        }

        // Fun√ß√£o para confirmar exclus√£o de usu√°rio
        function confirmDeleteUser(userId) {
            const users = getAllUsers();
            const user = users.find(u => u.id === userId);
            
            if (!user) {
                alert('Usu√°rio n√£o encontrado!');
                return;
            }
            
            if (confirm(`Tem certeza que deseja excluir o usu√°rio "${user.name}"?\n\nEsta a√ß√£o n√£o pode ser desfeita!`)) {
                const result = deleteUser(userId);
                if (result.success) {
                    alert(result.message);
                    renderUsersList();
                } else {
                    alert(result.message);
                }
            }
        }

        // Fun√ß√£o para visualizar progresso detalhado de um usu√°rio
        function viewUserProgress(userId) {
            const users = getAllUsers();
            const user = users.find(u => u.id === userId);
            
            if (!user) {
                alert('Usu√°rio n√£o encontrado!');
                return;
            }
            
            const progress = getUserProgressData(user.username);
            
            let html = `<h3 style="margin-bottom: 20px;">Progresso de ${user.name}</h3>`;
            
            trainingPaths.forEach(path => {
                const pathProgress = progress[path.id] || {};
                const totalModules = path.modules.length;
                const completedModules = Object.keys(pathProgress).filter(k => pathProgress[k]).length;
                const progressPercent = totalModules > 0 ? Math.round((completedModules / totalModules) * 100) : 0;
                
                html += `<div style="margin-bottom: 20px; padding: 15px; background-color: var(--light-gray); border-radius: 8px;">`;
                html += `<h4 style="margin-bottom: 10px;">${path.icon} ${path.name}</h4>`;
                html += `<div style="margin-bottom: 10px;">`;
                html += `<div style="background-color: var(--medium-gray); height: 8px; border-radius: 4px; overflow: hidden;">`;
                html += `<div style="background-color: var(--gold); height: 100%; width: ${progressPercent}%;"></div>`;
                html += `</div>`;
                html += `<p style="margin-top: 5px; font-size: 14px;">${completedModules}/${totalModules} m√≥dulos conclu√≠dos (${progressPercent}%)</p>`;
                html += `</div>`;
                
                // Listar m√≥dulos
                html += `<ul style="list-style: none; padding: 0;">`;
                path.modules.forEach(module => {
                    const isCompleted = pathProgress[module.id];
                    html += `<li style="padding: 8px; margin: 5px 0; background-color: var(--medium-gray); border-radius: 4px; display: flex; align-items: center;">`;
                    html += `<span style="margin-right: 10px; font-size: 18px;">${isCompleted ? '‚úÖ' : '‚¨ú'}</span>`;
                    html += `<span>${module.title}</span>`;
                    html += `</li>`;
                });
                html += `</ul>`;
                html += `</div>`;
            });
            
            document.getElementById('user-progress-content').innerHTML = html;
            document.getElementById('user-progress-modal').style.display = 'flex';
        }

        // Fun√ß√£o para fechar modal de progresso
        function closeUserProgressModal() {
            document.getElementById('user-progress-modal').style.display = 'none';
        }
    </script>
</body>
</html>
